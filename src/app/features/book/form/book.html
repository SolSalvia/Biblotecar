<!-- FORMULARIO DE ALTA -->
<form [formGroup]="form" (ngSubmit)="submit()" style="display:grid;gap:12px;max-width:520px;margin-bottom:24px;">
  <h2>Alta de Libro</h2>

  <label>ISBN
  <input formControlName="isbn" placeholder="978..." />
  <div *ngIf="f.isbn.invalid && (f.isbn.dirty || f.isbn.touched)">
    <small *ngIf="f.isbn.errors?.['required']">Requerido</small>
    <small *ngIf="f.isbn.errors?.['isbnInvalid']">ISBN inválido </small>
    <small *ngIf="f.isbn.errors?.['isbnTaken']">El ISBN ya existe</small>
  </div>
  <small *ngIf="f.isbn.pending">Verificando ISBN...</small>
</label>

  <label>Título
    <input type="text" id="title" formControlName="title" placeholder="Harry Potter y la piedra filosofal">
    <div *ngIf="f.title.invalid && (f.title.dirty || f.title.touched)">
      <small *ngIf="f.title.errors?.['required']">Requerido</small>
    </div>
  </label>

  <label>Autor
    <input type="text" id="author" formControlName="author" placeholder="J.K. Rowling">
    <div *ngIf="f.author.invalid && (f.author.dirty || f.author.touched)">
      <small *ngIf="f.author.errors?.['required']">Requerido</small>
    </div>
  </label>

  <label>Categoría
    <input type="text" id="category" formControlName="category" placeholder="Novela, Ciencia Ficción, Fantasía...">
    <div *ngIf="f.category.invalid && (f.category.dirty || f.category.touched)">
      <small *ngIf="f.category.errors?.['required']">Requerido</small>
    </div>
  </label>

 <label>Año de publicación
  <input type="number" formControlName="publicationYear" [attr.max]="currentYear" min="1450" />
  <div *ngIf="f.publicationYear.invalid && (f.publicationYear.dirty || f.publicationYear.touched)">
    <small *ngIf="f.publicationYear.errors?.['yearInvalid']">Año inválido</small>
    <small *ngIf="f.publicationYear.errors?.['yearOutOfRange'] as yr">
      Debe estar entre {{ yr.min }} y {{ yr.max }}
    </small>
    <small *ngIf="f.publicationYear.errors?.['required']">Requerido</small>
  </div>
</label>

  <label>Copias totales
    <input type="number" id="totalCopies" formControlName="totalCopies" placeholder="1" min="1" />
    <div *ngIf="f.totalCopies.invalid && (f.totalCopies.dirty || f.totalCopies.touched)">
      <small *ngIf="f.totalCopies.errors?.['required']">Requerido</small>
      <small *ngIf="f.totalCopies.errors?.['min']">Debe ser al menos 1</small>
    </div>
  </label>

  <label style="display:flex;align-items:center;gap:8px;">
    <input type="checkbox" formControlName="isActive" />
    Activo
  </label>

  <div style="display:flex;gap:8px;margin-top:8px">
    <button type="submit" [disabled]="form.invalid">Guardar</button>
    <button type="button" (click)="form.reset({publicationYear: currentYear, totalCopies: 1, isActive: true})">Limpiar</button>
  </div>
</form>

<!-- LISTADO / VISUALIZACIÓN -->
<section>
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
    <h2 style="margin:0;">Libros cargados</h2>
    <button type="button" (click)="loadBooks()">Actualizar</button>
  </div>

  <div *ngIf="loadingList">Cargando libros...</div>
  <div *ngIf="!loadingList && books.length === 0">No hay libros cargados.</div>

  <table *ngIf="!loadingList && books.length > 0" border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; width:100%; max-width:900px;">
    <thead>
      <tr>
        <th>ID</th>
        <th>ISBN</th>
        <th>Título</th>
        <th>Autor</th>
        <th>Categoría</th>
        <th>Año</th>
        <th>Copias</th>
        <th>Activo</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let b of books">
        <td>{{ b.id }}</td>
        <td>{{ b.isbn }}</td>
        <td>{{ b.title }}</td>
        <td>{{ b.author }}</td>
        <td>{{ b.category }}</td>
        <td>{{ b.publicationYear }}</td>
        <td>{{ b.totalCopies }}</td>
        <td>{{ b.isActive ? 'Sí' : 'No' }}</td>
      </tr>
    </tbody>
  </table>
</section>
